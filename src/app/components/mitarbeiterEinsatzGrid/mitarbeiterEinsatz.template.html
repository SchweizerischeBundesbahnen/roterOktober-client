<navbar></navbar>
<messages></messages>
<main>
  <div class="container-fluid bg-white">
    <div class="row col-lg-offset-1 col-lg-10">
          <table id="einsatzTabelle" class="table table-bordered">
            <thead class="thead-inverse">
              <tr>
              <th class="col-lg-2">Mitarbeiter</th>
              <th class="col-lg-2">Projekte</th>
              <th class="col-lg-8">
                <jahres-auswahl year="$ctrl.year"></jahres-auswahl>
                <table class="table col-lg-12">
                  <tr>
                    <th ng-repeat="month in $ctrl.months">{{ month }}</th>
                  </tr>
                </table>
              </th>
            </tr>
            </thead>
            <tbody>
              <tr ng-repeat-start="mitarbeiterEinsatz in $ctrl.mitarbeiterEinsaetze">
                <td rowspan="{{mitarbeiterEinsatz.einsatze.length}}">{{mitarbeiterEinsatz.mitarbeiter.name}} {{mitarbeiterEinsatz.mitarbeiter.vorname}}</td>
                <td>
                <ul class="list-group projectPanel" ng-show="mitarbeiterEinsatz.einsatze[0].projekt.name">
                  <li class="list-group-item">
                    <span class="badge">{{ mitarbeiterEinsatz.einsatze[0].senioritaet }} {{ mitarbeiterEinsatz.einsatze[0].rolle }}</span>
                    {{ mitarbeiterEinsatz.einsatze[0].projekt.name }}
                  </li>
                </ul>
                </td>
                <td>
                  <div class="progress timeaxis" ng-show="mitarbeiterEinsatz.einsatze[0].projekt.name">
                    <div class="progress-bar col-lg-offset-{{mitarbeiterEinsatz.einsatze[0].pensum.fromMonth}}"
                      role="progressbar" role="progressbar"
                      style="width: {{ mitarbeiterEinsatz.einsatze[0].pensum.untilYear === $ctrl.year ?
                      100/12 * (mitarbeiterEinsatz.einsatze[0].pensum.untilMonth - mitarbeiterEinsatz.einsatze[0].pensum.fromMonth)
                      : mitarbeiterEinsatz.einsatze[0].pensum.untilYear < $ctrl.year || mitarbeiterEinsatz.einsatze[0].pensum.fromYear > $ctrl.year ? 0 :100}}%"
                      ng-class="$index % 2 === 0 ? 'progress-bar-success' : progress-bar-info"
                      >
                      {{ mitarbeiterEinsatz.einsatze[0].pensum.pensum.pensum }} %
                    </div>
                  </div>
                </td>
              </tr>
              <tr ng-repeat-end ng-repeat="einsatz in mitarbeiterEinsatz.einsatze.slice(1)">
                <td>
                  <ul class="list-group projectPanel" ng-show="einsatz.projekt.name">
                    <li class="list-group-item">
                      <span class="badge">{{ einsatz.senioritaet }} {{ einsatz.rolle }}</span>
                      {{ einsatz.projekt.name }}
                    </li>
                  </ul>
                </td>
                <td>
                  <div class="progress timeaxis" ng-show="einsatz.projekt.name">
                    <div class="progress-bar col-lg-offset-{{einsatz.pensum.fromMonth}}"
                      role="progressbar" role="progressbar"
                      style="width: {{ einsatz.pensum.untilYear === $ctrl.year ? 100/12 * (einsatz.pensum.untilMonth - einsatz.pensum.fromMonth) :
                        einsatz.pensum.untilYear < $ctrl.year || einsatz.pensum.fromYear > $ctrl.year ? 0 :100}}%"
                      ng-class="$parent.$index % 2 === 0 ? 'progress-bar-success' : progress-bar-info">
                      {{ einsatz.pensum.pensum.pensum }} %
                    </div>
                  </div>
                </td>
              </tr>
            </tbody>
          </table>
      </div>
  </div>
</main>
